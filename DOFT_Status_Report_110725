# DOFT — Estado actual y evidencia (borrador)

**Fecha:** (completar)

Este documento resume el estado del pipeline DOFT con `materials_clusters_real_v5.csv`. Incluye calibración, anclas de cluster, fingerprints (entero y racional), residuales por subred y validación estadística. La meta es fijar una base reproducible para comparar familias y subredes sin desviarnos del modelo DOFT.

---

## 1) Calibración (solo Type-I/II)

- **Gamma (g):** 1.53506e-17  _(del último log)_
- **Eta (e):** 3.984578e-05  _(del último log)_
- **Winsorización de X:** límite superior = 600.
- **Estabilidad (Leave-One-Out, de los últimos logs):** mayor influencia al remover **Hf, NbN, Tl, La**; mínima influencia **Al, Cd, Zr**.
- **Bootstrap (N=500, corridas recientes):**  
  g ≈ O(10⁻¹٧) con ICs que incluyen 0 (ligado a restricciones g≥0);  
  e ≈ 4.0×10⁻⁵ con IC95% ~[~6–7]×10⁻⁶ a ~6–7×10⁻⁵.

> Estos parámetros se guardaron en `doft_config.json` y se usan para la corrección universal.

---

## 2) Clusters / Subredes y contraste C_AB

**Anclas definidas:**  
- **SC (multibanda):** 2H-NbSe₂ (σ, π), MgB₂ (σ, π), FeSe (σ, π)  
- **Hidruros HP:** LaH₁₀ (La-acous-σ, H1-optic-σ, H2-optic-π)  
- **Superfluidos:** He-3 B-phase (0 vs 10 bar), He-4 (1 vs 10 bar)

**Regla de contraste actual:** subredes con `sub_order` consecutivo (1↔2; para LaH₁₀ se aplicó **optic–optic** 2↔3 en la corrida con κ).  
**Nota práctica:** fijar en configuración la convención *una sola vez* (e.g. “optic–optic” **o** “acoustic–optic”) y forzar `sub_order` determinista para reproducibilidad.

**κ (fit con restricción κ≥0):** en general 0; **MgB₂** muestra **κ ≈ 0.00597** (inter-banda leve).

---

## 3) Fingerprints por **categoría**

### Entero (exp_a_2, exp_b_3, exp_c_5, exp_d_7) — promedios recientes
- **SC_TypeI:** a₂≈1.56, b₃≈0.82, c₅≈0.52, d₇≈0.41  
- **SC_TypeII:** a₂≈1.94, b₃≈0.59, c₅≈0.52, d₇≈0.41  
- **SC_HighPressure (HP):** a₂≈1.09–1.10, **d₇≈0.08** (estable en bootstrap)  
- **SC_Binary:** a₂≈1.26, b₃≈0.61, c₅≈0.35, d₇≈0.42  
- **SC_IronBased (single agregado):** a₂≈0.60, b₃≈0.60, c₅≈0.00, d₇≈0.40

### Racional (q promedio por familia)
- **Superfluid:** q ≈ 2.2–2.3  
- **SC_Oxide:** q ≈ 4.94–4.96  
- **SC_IronBased:** q ≈ 4.45–4.62 (según versión)  
- **SC_HighPressure:** q ≈ 5.68–5.86  
- **SC_HeavyFermion:** q ≈ 5.38

**Lecturas rápidas**
- **Type-I vs Type-II**: sin separación significativa en los exponentes (ver §6).  
- **HP**: patrón estable (a₂ bajo ~1.1 y d₇ bajo ~0.08).  
- **Superfluids**: q notablemente menor que SC (ver §6, KS).

---

## 4) Fingerprints por **subred**

### Entero (promedios)
- **σ/π (multibanda):**  
  π: a₂≈3, b₃≈1, c₅≈0, d₇≈0  
  σ: a₂≈0.86, b₃≈0.57, c₅≈0.43, d₇≈0.43  
- **LaH₁₀ (subredes):**  
  La-acous-σ: a₂≈1.33, b₃≈0.67, c₅≈0.33, d₇≈0  
  H1-optic-σ: a₂≈1.33, b₃≈0, c₅≈0.67, d₇≈0

### Racional (q por subred)
- **sigma-vs-pi:** q ≈ 4.5–8 (según versión; sensible a la convención)  
- **He-4 (1bar,10bar):** q ≈ 1 y 2.17 (pares vs muestran ~1 o ~4.5)  
- **He-3 B-phase (0↔10 bar):** q de pares vs ≈ 4–4.6 (n bajo)

> Subredes con **n pequeño** (LaH₁₀ y varios pares “vs”) deben rotularse como **exploratorio**; los ICs de bootstrap ya lo reflejan.

---

## 5) Residuales (log R_corr_eta − log prime_value)

**Resumen (última corrida, por categoría+subred):**  
- SC_Binary: residuales cercanos a 0 (σ/π/single; σ-vs-π levemente negativos)  
- SC_HighPressure: single ~−0.003±0.039; **La-acous-σ** disperso (muestra chica)  
- SC_IronBased: single ~−0.0027±0.0205  
- Superfluidos: **0-bar** (~−0.156), **10-bar** (~−0.069), pares vs ~+0.01 (n bajo)

Interpretación: los residuales se estabilizan para SC; los superfluidos quedan por debajo (consistente con proxies T_F/roton).

---

## 6) Validación estadística (resumen)

**Kruskal-Wallis (omnibus por exponente):**  
- **a₂:** diferencias globales (p≈0.03–0.12 según versión).  
- **d₇:** diferencias globales robustas (p≈6.9×10⁻⁵–0.0059).

**Mann-Whitney (par a par):**  
- **Type-I vs Type-II:** a₂, b₃, c₅, d₇ → **no significativos** (p≈0.3–1).  
- **HP vs Type-I/II:**  
  - **a₂:** p≈0.04 (vs Type-I) / p≈0.01 (vs Type-II); Cliff’s d ~−0.24/−0.29.  
  - **d₇:** **p≈8.3×10⁻⁵** (vs ambos); Cliff’s d ~−0.296; CLES ~0.35.  
  - b₃/c₅: no robustos tras FDR.

**KS (q racional):**  
- **Superfluid vs SC (Oxide / IronBased):** distribuciones **distintas** (p≪0.01).  
- **Oxide vs Molecular / IronBased:** sin evidencia de diferencia (n actuales).

---

## 7) Decisiones y supuestos (Superfluidos)

- **Excluir He-3 A-phase** (riesgo de sesgo experimental/confinamiento; pares limpios no disponibles).  
- Mantener **He-3 B-phase** (0 & 10 bar) y **He-4** (1 & 10 bar).  
- Documentar que **Θ_D** se toma como proxy (**T_F** en He-3; **roton** en He-4) y que **Δ** es proxy BCS para p-wave (cuando aplica).

---

## 8) Limitaciones conocidas

- **n bajo** en varias subredes (LaH₁₀ y pares “vs”); IC anchos.  
- **Convención de contraste** en LaH₁₀ (optic–optic vs acoustic–optic) debe fijarse en config.  
- **Type-I/II**: base de calibración útil, pero **no** separa fingerprint entero.

---

## 9) Próximos pasos (foco DOFT)

1. **Fijar la regla de contraste** (y `sub_order`) en config con asserts.  
2. **Reportar HP vs Metálicos** con tabla formal: p_FDR + Cliff’s d + CLES (a₂, d₇).  
3. **Marcar como exploratorio** subredes con n bajo; priorizar adquisición o exclusión consistente.  
4. **Congelar** `materials_clusters_real_v5_FREEZE.csv` y publicar hashes de resultados.  
5. **Apéndice de métodos**: definición de X, construcción de prime_values, winsor de X y detalle de proxies en superfluidos.

---

## 10) Archivos clave (última corrida)

- `summary_final_calib.csv`, `results_final_calib.csv` — parámetros y correcciones  
- `results_cluster_kappa_fit.csv` / `results_fingerprints.csv` — diagnóstico de clusters y residuales por subred  
- `results_final_fingerprint_full_factorized.csv` (+ variante _WITH_KAPPA_) — factorizado completo  
- `fingerprint_final_fingerprint_by_category_*.csv` — fingerprint por familia  
- `fingerprint_final_fingerprint_by_subnetwork_*.csv` — fingerprint por subred  
- `results_statistical_validation.csv` — KW/MWU/KS + tamaños de efecto

